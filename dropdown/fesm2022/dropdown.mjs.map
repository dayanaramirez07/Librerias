{"version":3,"file":"dropdown.mjs","sources":["../../../projects/dropdown/src/lib/components/dropdown/dropdown.component.ts","../../../projects/dropdown/src/lib/components/dropdown/dropdown.component.html","../../../projects/dropdown/src/public-api.ts","../../../projects/dropdown/src/dropdown.ts"],"sourcesContent":["import { CommonModule } from '@angular/common';\r\nimport { Component, EventEmitter, Input, Output, SimpleChanges } from '@angular/core';\r\nimport { ControlValueAccessor, FormsModule, NG_VALUE_ACCESSOR } from '@angular/forms';\r\n\r\n@Component({\r\n  selector: 'app-dropdown',\r\n  standalone: true,\r\n  imports: [\r\n    FormsModule,\r\n    CommonModule\r\n  ],\r\n  templateUrl: './dropdown.component.html',\r\n  styleUrl: './dropdown.component.css',\r\n  providers: [{\r\n    provide: NG_VALUE_ACCESSOR,\r\n    useExisting: DropdownComponent,\r\n    multi: true\r\n  }]\r\n})\r\nexport class DropdownComponent implements ControlValueAccessor {\r\n\r\n  public onChange: (value: any) => void = () => { };\r\n  public onTouched: () => void = () => { };\r\n  public isDisabled: boolean = false;\r\n  public isTouched: boolean = false;\r\n\r\n  protected indiceActivo: number = 0;\r\n  protected listadoActivo: boolean = false;\r\n  protected listadoFiltrado: Array<any> = [];\r\n  protected busquedaRealizada: boolean = false;\r\n\r\n  @Input() public value: any;\r\n  @Input() public label: string = '';\r\n  @Input() public listado: Array<any> = [];\r\n  @Input() public placeholder: string = '';\r\n  @Input() public agregarItem: boolean = false;\r\n\r\n  /**\r\n   * Propiedad de los objetos del listado que se va a usar para filtrar\r\n   */\r\n  @Input() public propiedades: string[] = [];\r\n  @Output() public blurEvent: EventEmitter<void> = new EventEmitter<void>();\r\n  @Output() public itemSeleccionado: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  /**\r\n   * Acción del botón\r\n   */\r\n  @Input() public accion: any;\r\n  @Output() public accionSeleccionada: EventEmitter<any> = new EventEmitter();\r\n\r\n  protected mensajes = {\r\n    noExiste: 'No existe'\r\n  }\r\n\r\n  public ngOnInit(): void {\r\n    this.writeValue(this.value);\r\n  }\r\n\r\n  public ngOnChanges(changes: SimpleChanges): void {\r\n    if (changes['value']) {\r\n      this.writeValue(changes['value'].currentValue);\r\n    }\r\n  }\r\n\r\n  public writeValue(value: any): void {\r\n    this.value = value;\r\n\r\n    if (typeof this.value === 'object') {\r\n      if (this.value && this.propiedades.length > 0) {\r\n        this.value = this.propiedades\r\n          .map(prop => this.value[prop])\r\n          .filter(val => val)\r\n          .join(' - ');\r\n      } else {\r\n        this.value = '';\r\n      }\r\n    }\r\n\r\n    this.listadoFiltrado = [];\r\n  }\r\n\r\n  public registerOnChange(fn: any): void {\r\n    this.onChange = fn;\r\n  }\r\n\r\n  public registerOnTouched(fn: any): void {\r\n    this.onTouched = fn;\r\n  }\r\n\r\n  public setDisabledState?(isDisabled: boolean): void {\r\n    this.isDisabled = isDisabled;\r\n  }\r\n\r\n  public forzarReporteCambios(itemSeleccionado: any) {\r\n    if (this.agregarItem && !itemSeleccionado) {\r\n      this.value = this.value\r\n    } else {\r\n      this.value = itemSeleccionado || '';\r\n    }\r\n\r\n    const objetoOriginal = this.listado.find(item =>\r\n      this.propiedades.map(prop => item[prop]).join(' - ') === this.value\r\n    );\r\n\r\n    this.onChange(this.value);\r\n\r\n    if (!this.value) {\r\n      this.itemSeleccionado.emit('');\r\n      return;\r\n    }\r\n\r\n    this.itemSeleccionado.emit(objetoOriginal || this.value);\r\n    this.listadoActivo = false;\r\n    this.busquedaRealizada = false;\r\n  }\r\n\r\n  public buscar(event: KeyboardEvent) {\r\n    this.listadoActivo = false;\r\n    this.busquedaRealizada = true;\r\n\r\n    const value = this.value.toLowerCase();\r\n\r\n    if (value === '') {\r\n      this.forzarReporteCambios(value);\r\n      this.busquedaRealizada = false;\r\n      return;\r\n    }\r\n\r\n    this.listadoFiltrado = this.listado\r\n      .map(item => {\r\n        const texto = this.propiedades.map(prop => item[prop]).join(' - ');\r\n        return { item, texto };\r\n      })\r\n      .filter(({ texto }) => texto.toLowerCase().includes(value))\r\n      .map(({ texto }) => texto);\r\n\r\n    if (this.listadoFiltrado.length > 0) {\r\n      this.listadoActivo = true;\r\n    }\r\n\r\n    this.establecerItemActivo(event.code);\r\n  }\r\n\r\n  public establecerItemActivo(codigoTecla: string) {\r\n    if (this.listadoFiltrado.length === 0) {\r\n      if (this.agregarItem) {\r\n        this.forzarReporteCambios(this.value);\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if (codigoTecla === 'ArrowDown') {\r\n      this.indiceActivo = (this.indiceActivo + 1) % this.listadoFiltrado.length;\r\n    } else if (codigoTecla === 'ArrowUp') {\r\n      this.indiceActivo = (this.indiceActivo - 1 + this.listadoFiltrado.length) % this.listadoFiltrado.length;\r\n    } else if (codigoTecla === 'Enter' && this.indiceActivo >= 0) {\r\n      const itemSeleccionado = this.listadoFiltrado[this.indiceActivo];\r\n      this.forzarReporteCambios(itemSeleccionado);\r\n    }\r\n\r\n    setTimeout(() => {\r\n      const element = document.querySelector('.dropdown-item.is-active');\r\n      if (element) {\r\n        element.scrollIntoView({ block: 'nearest' });\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  public onInputBlur(): void {\r\n    this.busquedaRealizada = false;\r\n\r\n    if (this.label) {\r\n      this.isTouched = true;\r\n    }\r\n\r\n    if ((this.isEmpty(this.value) || !this.valorEsValido(this.value))) {\r\n      this.forzarReporteCambios('');\r\n    }\r\n\r\n    this.onTouched();\r\n    this.blurEvent.emit();\r\n  }\r\n\r\n  public isEmpty(value: any): boolean {\r\n    return !value || value.trim() === '';\r\n  }\r\n\r\n  protected valorEsValido(value: string): boolean {\r\n    if (!value) return false;\r\n\r\n    return this.listado.some(item => {\r\n      const texto = this.propiedades.map(prop => item[prop]).join(' - ');\r\n      return texto === value;\r\n    });\r\n  }\r\n\r\n  public onAccionSeleccionada(event: any): void {\r\n    this.accionSeleccionada.emit(event);\r\n  }\r\n\r\n}","<div class=\"row\" [ngClass]=\"label ? 'mb-3' : ''\">\r\n\r\n    <label *ngIf=\"label\" class=\"col-sm-4 col-form-label\">{{ label }}</label>\r\n\r\n    <div class=\"col-sm-8 dropdown position-relative\">\r\n\r\n        <div class=\"input-group\">\r\n\r\n            <input \r\n                type=\"text\" \r\n                name=\"value\" \r\n                [(ngModel)]=\"value\" \r\n                class=\"form-control dropdown-toggle\"\r\n                [ngClass]=\"{'is-invalid': isTouched && isEmpty(value)}\"\r\n                (click)=\"onTouched()\"\r\n                (keyup)=\"buscar($event)\"\r\n                (blur)=\"onInputBlur()\"\r\n                [disabled]=\"isDisabled\" \r\n                [placeholder]=\"placeholder\"\r\n                data-bs-toggle=\"dropdown\"\r\n                autocomplete=\"off\">\r\n            \r\n            <ul class=\"dropdown-menu overflow-auto rounded-0 position-absolute\"\r\n                [ngStyle]=\"{ 'display': busquedaRealizada ? 'block' : 'none' }\">\r\n                <ng-container *ngIf=\"listadoFiltrado.length > 0; else noExiste\">\r\n                    <li\r\n                        class=\"dropdown-item\"\r\n                        *ngFor=\"let i = index; let item of listadoFiltrado\" \r\n                        [class.is-active]=\"indiceActivo === i\"\r\n                        (mousedown)=\"forzarReporteCambios(item)\">\r\n                        {{item}}\r\n                    </li>\r\n                </ng-container>\r\n                <ng-template #noExiste>\r\n                    <li class=\"dropdown-item disabled\">{{ mensajes.noExiste }}</li>\r\n                </ng-template>\r\n            </ul>\r\n\r\n            <button *ngIf=\"accion\" class=\"btn btn-light ms-2\" (click)=\"onAccionSeleccionada(accion)\">\r\n                <span class=\"icon is-small\">\r\n                    <i class=\"fas\" [ngClass]=\"accion.icono\"></i>\r\n                </span>\r\n            </button>\r\n\r\n        </div>\r\n\r\n    </div>\r\n\r\n</div>","/*\r\n * Public API Surface of dropdown\r\n */\r\n\r\nexport * from './lib/components/dropdown/dropdown.component';","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":";;;;;;;MAmBa,iBAAiB,CAAA;AAf9B,IAAA,WAAA,GAAA;AAiBS,QAAA,IAAA,CAAA,QAAQ,GAAyB,MAAK,GAAI;AAC1C,QAAA,IAAA,CAAA,SAAS,GAAe,MAAK,GAAI;QACjC,IAAU,CAAA,UAAA,GAAY,KAAK;QAC3B,IAAS,CAAA,SAAA,GAAY,KAAK;QAEvB,IAAY,CAAA,YAAA,GAAW,CAAC;QACxB,IAAa,CAAA,aAAA,GAAY,KAAK;QAC9B,IAAe,CAAA,eAAA,GAAe,EAAE;QAChC,IAAiB,CAAA,iBAAA,GAAY,KAAK;QAG5B,IAAK,CAAA,KAAA,GAAW,EAAE;QAClB,IAAO,CAAA,OAAA,GAAe,EAAE;QACxB,IAAW,CAAA,WAAA,GAAW,EAAE;QACxB,IAAW,CAAA,WAAA,GAAY,KAAK;AAE5C;;AAEG;QACa,IAAW,CAAA,WAAA,GAAa,EAAE;AACzB,QAAA,IAAA,CAAA,SAAS,GAAuB,IAAI,YAAY,EAAQ;AACxD,QAAA,IAAA,CAAA,gBAAgB,GAAsB,IAAI,YAAY,EAAO;AAM7D,QAAA,IAAA,CAAA,kBAAkB,GAAsB,IAAI,YAAY,EAAE;AAEjE,QAAA,IAAA,CAAA,QAAQ,GAAG;AACnB,YAAA,QAAQ,EAAE;SACX;AAqJF;IAnJQ,QAAQ,GAAA;AACb,QAAA,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC;;AAGtB,IAAA,WAAW,CAAC,OAAsB,EAAA;AACvC,QAAA,IAAI,OAAO,CAAC,OAAO,CAAC,EAAE;YACpB,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,YAAY,CAAC;;;AAI3C,IAAA,UAAU,CAAC,KAAU,EAAA;AAC1B,QAAA,IAAI,CAAC,KAAK,GAAG,KAAK;AAElB,QAAA,IAAI,OAAO,IAAI,CAAC,KAAK,KAAK,QAAQ,EAAE;AAClC,YAAA,IAAI,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE;AAC7C,gBAAA,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;qBACf,GAAG,CAAC,IAAI,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;AAC5B,qBAAA,MAAM,CAAC,GAAG,IAAI,GAAG;qBACjB,IAAI,CAAC,KAAK,CAAC;;iBACT;AACL,gBAAA,IAAI,CAAC,KAAK,GAAG,EAAE;;;AAInB,QAAA,IAAI,CAAC,eAAe,GAAG,EAAE;;AAGpB,IAAA,gBAAgB,CAAC,EAAO,EAAA;AAC7B,QAAA,IAAI,CAAC,QAAQ,GAAG,EAAE;;AAGb,IAAA,iBAAiB,CAAC,EAAO,EAAA;AAC9B,QAAA,IAAI,CAAC,SAAS,GAAG,EAAE;;AAGd,IAAA,gBAAgB,CAAE,UAAmB,EAAA;AAC1C,QAAA,IAAI,CAAC,UAAU,GAAG,UAAU;;AAGvB,IAAA,oBAAoB,CAAC,gBAAqB,EAAA;AAC/C,QAAA,IAAI,IAAI,CAAC,WAAW,IAAI,CAAC,gBAAgB,EAAE;AACzC,YAAA,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK;;aAClB;AACL,YAAA,IAAI,CAAC,KAAK,GAAG,gBAAgB,IAAI,EAAE;;AAGrC,QAAA,MAAM,cAAc,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,IAC3C,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,IAAI,CAAC,KAAK,CACpE;AAED,QAAA,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC;AAEzB,QAAA,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;AACf,YAAA,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,EAAE,CAAC;YAC9B;;QAGF,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,KAAK,CAAC;AACxD,QAAA,IAAI,CAAC,aAAa,GAAG,KAAK;AAC1B,QAAA,IAAI,CAAC,iBAAiB,GAAG,KAAK;;AAGzB,IAAA,MAAM,CAAC,KAAoB,EAAA;AAChC,QAAA,IAAI,CAAC,aAAa,GAAG,KAAK;AAC1B,QAAA,IAAI,CAAC,iBAAiB,GAAG,IAAI;QAE7B,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE;AAEtC,QAAA,IAAI,KAAK,KAAK,EAAE,EAAE;AAChB,YAAA,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC;AAChC,YAAA,IAAI,CAAC,iBAAiB,GAAG,KAAK;YAC9B;;AAGF,QAAA,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;aACzB,GAAG,CAAC,IAAI,IAAG;YACV,MAAM,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC;AAClE,YAAA,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE;AACxB,SAAC;AACA,aAAA,MAAM,CAAC,CAAC,EAAE,KAAK,EAAE,KAAK,KAAK,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,KAAK,CAAC;aACzD,GAAG,CAAC,CAAC,EAAE,KAAK,EAAE,KAAK,KAAK,CAAC;QAE5B,IAAI,IAAI,CAAC,eAAe,CAAC,MAAM,GAAG,CAAC,EAAE;AACnC,YAAA,IAAI,CAAC,aAAa,GAAG,IAAI;;AAG3B,QAAA,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC,IAAI,CAAC;;AAGhC,IAAA,oBAAoB,CAAC,WAAmB,EAAA;QAC7C,IAAI,IAAI,CAAC,eAAe,CAAC,MAAM,KAAK,CAAC,EAAE;AACrC,YAAA,IAAI,IAAI,CAAC,WAAW,EAAE;AACpB,gBAAA,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,KAAK,CAAC;;YAGvC;;AAGF,QAAA,IAAI,WAAW,KAAK,WAAW,EAAE;AAC/B,YAAA,IAAI,CAAC,YAAY,GAAG,CAAC,IAAI,CAAC,YAAY,GAAG,CAAC,IAAI,IAAI,CAAC,eAAe,CAAC,MAAM;;AACpE,aAAA,IAAI,WAAW,KAAK,SAAS,EAAE;YACpC,IAAI,CAAC,YAAY,GAAG,CAAC,IAAI,CAAC,YAAY,GAAG,CAAC,GAAG,IAAI,CAAC,eAAe,CAAC,MAAM,IAAI,IAAI,CAAC,eAAe,CAAC,MAAM;;aAClG,IAAI,WAAW,KAAK,OAAO,IAAI,IAAI,CAAC,YAAY,IAAI,CAAC,EAAE;YAC5D,MAAM,gBAAgB,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,YAAY,CAAC;AAChE,YAAA,IAAI,CAAC,oBAAoB,CAAC,gBAAgB,CAAC;;QAG7C,UAAU,CAAC,MAAK;YACd,MAAM,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,0BAA0B,CAAC;YAClE,IAAI,OAAO,EAAE;gBACX,OAAO,CAAC,cAAc,CAAC,EAAE,KAAK,EAAE,SAAS,EAAE,CAAC;;SAE/C,EAAE,CAAC,CAAC;;IAGA,WAAW,GAAA;AAChB,QAAA,IAAI,CAAC,iBAAiB,GAAG,KAAK;AAE9B,QAAA,IAAI,IAAI,CAAC,KAAK,EAAE;AACd,YAAA,IAAI,CAAC,SAAS,GAAG,IAAI;;QAGvB,KAAK,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG;AACjE,YAAA,IAAI,CAAC,oBAAoB,CAAC,EAAE,CAAC;;QAG/B,IAAI,CAAC,SAAS,EAAE;AAChB,QAAA,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE;;AAGhB,IAAA,OAAO,CAAC,KAAU,EAAA;QACvB,OAAO,CAAC,KAAK,IAAI,KAAK,CAAC,IAAI,EAAE,KAAK,EAAE;;AAG5B,IAAA,aAAa,CAAC,KAAa,EAAA;AACnC,QAAA,IAAI,CAAC,KAAK;AAAE,YAAA,OAAO,KAAK;QAExB,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,IAAG;YAC9B,MAAM,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC;YAClE,OAAO,KAAK,KAAK,KAAK;AACxB,SAAC,CAAC;;AAGG,IAAA,oBAAoB,CAAC,KAAU,EAAA;AACpC,QAAA,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,KAAK,CAAC;;+GAnL1B,iBAAiB,EAAA,IAAA,EAAA,EAAA,EAAA,MAAA,EAAA,EAAA,CAAA,eAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AAAjB,IAAA,SAAA,IAAA,CAAA,IAAA,GAAA,EAAA,CAAA,oBAAA,CAAA,EAAA,UAAA,EAAA,QAAA,EAAA,OAAA,EAAA,SAAA,EAAA,IAAA,EAAA,iBAAiB,sVANjB,CAAC;AACV,gBAAA,OAAO,EAAE,iBAAiB;AAC1B,gBAAA,WAAW,EAAE,iBAAiB;AAC9B,gBAAA,KAAK,EAAE;AACR,aAAA,CAAC,ECjBJ,aAAA,EAAA,IAAA,EAAA,QAAA,EAAA,EAAA,EAAA,QAAA,EAAA,w/DAgDM,EDxCF,MAAA,EAAA,CAAA,ggBAAA,CAAA,EAAA,YAAA,EAAA,CAAA,EAAA,IAAA,EAAA,UAAA,EAAA,IAAA,EAAA,WAAW,8mBACX,YAAY,EAAA,EAAA,EAAA,IAAA,EAAA,WAAA,EAAA,IAAA,EAAA,EAAA,CAAA,OAAA,EAAA,QAAA,EAAA,WAAA,EAAA,MAAA,EAAA,CAAA,OAAA,EAAA,SAAA,CAAA,EAAA,EAAA,EAAA,IAAA,EAAA,WAAA,EAAA,IAAA,EAAA,EAAA,CAAA,OAAA,EAAA,QAAA,EAAA,kBAAA,EAAA,MAAA,EAAA,CAAA,SAAA,EAAA,cAAA,EAAA,eAAA,CAAA,EAAA,EAAA,EAAA,IAAA,EAAA,WAAA,EAAA,IAAA,EAAA,EAAA,CAAA,IAAA,EAAA,QAAA,EAAA,QAAA,EAAA,MAAA,EAAA,CAAA,MAAA,EAAA,UAAA,EAAA,UAAA,CAAA,EAAA,EAAA,EAAA,IAAA,EAAA,WAAA,EAAA,IAAA,EAAA,EAAA,CAAA,OAAA,EAAA,QAAA,EAAA,WAAA,EAAA,MAAA,EAAA,CAAA,SAAA,CAAA,EAAA,CAAA,EAAA,CAAA,CAAA;;4FAUH,iBAAiB,EAAA,UAAA,EAAA,CAAA;kBAf7B,SAAS;+BACE,cAAc,EAAA,UAAA,EACZ,IAAI,EACP,OAAA,EAAA;wBACP,WAAW;wBACX;AACD,qBAAA,EAAA,SAAA,EAGU,CAAC;AACV,4BAAA,OAAO,EAAE,iBAAiB;AAC1B,4BAAA,WAAW,EAAmB,iBAAA;AAC9B,4BAAA,KAAK,EAAE;yBACR,CAAC,EAAA,QAAA,EAAA,w/DAAA,EAAA,MAAA,EAAA,CAAA,ggBAAA,CAAA,EAAA;8BAcc,KAAK,EAAA,CAAA;sBAApB;gBACe,KAAK,EAAA,CAAA;sBAApB;gBACe,OAAO,EAAA,CAAA;sBAAtB;gBACe,WAAW,EAAA,CAAA;sBAA1B;gBACe,WAAW,EAAA,CAAA;sBAA1B;gBAKe,WAAW,EAAA,CAAA;sBAA1B;gBACgB,SAAS,EAAA,CAAA;sBAAzB;gBACgB,gBAAgB,EAAA,CAAA;sBAAhC;gBAKe,MAAM,EAAA,CAAA;sBAArB;gBACgB,kBAAkB,EAAA,CAAA;sBAAlC;;;AEhDH;;AAEG;;ACFH;;AAEG;;;;"}